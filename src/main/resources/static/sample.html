<!DOCTYPE html>
<html>
<head>
    <title>SSE Notification Test</title>
    <style>
        body { font-family: Arial; background:#f4f4f4; padding:20px; }
        li { cursor:pointer; margin-bottom:8px; }
        .sender { font-size:12px; color:gray; }
        .notif-link {
    font-size: 13px;
    color: #007bff;
    text-decoration: underline;
}
.notif-link:hover {
    color: #0056b3;
}

    </style>
</head>
<body>

<h2>ðŸ”” Live Notifications</h2>
<p id="status">Connecting...</p>
<ul id="notifications"></ul>

<script>
    // Request browser permission
    if ("Notification" in window) {
        Notification.requestPermission();
    }

    const eventSource = new EventSource(
        "http://localhost:8081/api/notifications/subscribe-test"
    );

eventSource.onopen = () => {
    document.getElementById("status").innerText = "ðŸŸ¢ Connected";
    document.getElementById("status").style.color = "green";
};


    // ORDER PLACED
    eventSource.addEventListener("ORDER_PLACED", e => {
        const data = JSON.parse(e.data);
        renderNotification(data);
        showPopup("Order Placed", data.message, data.link);
    });


function renderNotification(data) {
    const li = document.createElement("li");

    li.innerHTML = `
        <b>${data.type}</b> â†’ ${data.message}<br/>

        <span class="sender">
            From: ${data.senderId ?? "System"}
        </span><br/>

        ${
            data.link
            ? `<a href="${data.link}" class="notif-link" target="_self">
                   View details â†’
               </a>`
            : ""
        }
    `;

    // Click anywhere on notification
    li.onclick = () => {
        if (data.link) {
            window.location.href = data.link;
        }
    };

    document.getElementById("notifications").appendChild(li);
}
     function showPopup(title, message, link) {
        if (Notification.permission === "granted") {
            const n = new Notification(title, { body: message });
            n.onclick = () => {
                if (link) window.location.href = link;
            };
        }
    }
</script>
</body>
</html>
